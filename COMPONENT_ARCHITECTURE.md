# TaskiPin - Component Architecture

## üìê Architecture Overview

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         page.tsx                             ‚îÇ
‚îÇ                    (Main Application)                        ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ         useTaskManager Hook                            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  (Manages all state: tasks, groups, history, settings)‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ        localStorage Utilities                ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - loadState()   - saveState()               ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Auto-save on every state change           ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  Components:                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  TaskGroup   ‚îÇ ‚îÇ  TaskItem   ‚îÇ ‚îÇ PomodoroTimer    ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  Component   ‚îÇ ‚îÇ  Component  ‚îÇ ‚îÇ  Component       ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Settings     ‚îÇ ‚îÇ DeleteModal  ‚îÇ ‚îÇ VoiceAssistant  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  Panel        ‚îÇ ‚îÇ  Component   ‚îÇ ‚îÇ  Component      ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                           ‚îÇ                  ‚îÇ
‚îÇ                                           ‚ñº                  ‚îÇ
‚îÇ                                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
‚îÇ                                  ‚îÇ voiceCommands.ts ‚îÇ       ‚îÇ
‚îÇ                                  ‚îÇ  - transcribe()  ‚îÇ       ‚îÇ
‚îÇ                                  ‚îÇ  - parseCommand()‚îÇ       ‚îÇ
‚îÇ                                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îÇ                                           ‚îÇ                  ‚îÇ
‚îÇ                                           ‚ñº                  ‚îÇ
‚îÇ                                    OpenAI API               ‚îÇ
‚îÇ                              (Whisper + GPT-3.5-turbo)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîÑ Data Flow

### 1. Task Creation Flow
```
User Input ‚Üí Add Task Button ‚Üí useTaskManager.addTask()
                                      ‚Üì
                              Create Task Object
                                      ‚Üì
                              Update State Array
                                      ‚Üì
                              Auto-save to localStorage
                                      ‚Üì
                              Re-render TaskItem Components
```

### 2. Voice Command Flow
```
User Clicks Mic ‚Üí VoiceAssistant.startRecording()
                           ‚Üì
                  Record Audio (MediaRecorder)
                           ‚Üì
                  Stop Recording ‚Üí Blob Created
                           ‚Üì
            voiceCommands.transcribeAudio(blob, apiKey)
                           ‚Üì
                  OpenAI Whisper API ‚Üí Transcription
                           ‚Üì
            voiceCommands.parseCommand(text, apiKey)
                           ‚Üì
                  OpenAI GPT ‚Üí Parsed Command Object
                           ‚Üì
            handleVoiceCommand(command) in page.tsx
                           ‚Üì
            Execute appropriate useTaskManager function
                           ‚Üì
                  State Updated ‚Üí UI Updates
```

### 3. Pomodoro Timer Flow
```
Start Timer ‚Üí setState(isRunning: true)
                     ‚Üì
              useEffect Triggered
                     ‚Üì
              setInterval (1 second)
                     ‚Üì
              Decrement timeLeft
                     ‚Üì
         timeLeft === 0 ‚Üí nextPhase()
                     ‚Üì
              Update phase state
                     ‚Üì
         Show Notification (if enabled)
                     ‚Üì
         Auto-start next phase (if enabled)
```

### 4. Drag-and-Drop Flow
```
User Drags Task ‚Üí onDragStart(taskId)
                         ‚Üì
                  Store draggedTaskId
                         ‚Üì
              User Drops on Target Task
                         ‚Üì
              onDrop(targetTaskId)
                         ‚Üì
         Calculate new positions in array
                         ‚Üì
         Update order property for all tasks
                         ‚Üì
         reorderTasks(newArray)
                         ‚Üì
         Auto-save ‚Üí Re-render
```

---

## üß© Component Details

### page.tsx (Main Container)
**Responsibilities:**
- Orchestrates all components
- Manages application state via useTaskManager
- Handles drag-and-drop logic
- Processes voice commands
- Renders sections: Groups, Active, Completed, History

**Key State:**
- `tasks`, `groups`, `history`, `settings` (from hook)
- `newTaskTitle`, `newTaskDescription`
- `deleteModalState`
- `isPomodoroVisible`
- `isSettingsOpen`
- `draggedTaskId`

---

### TaskItem Component
**Props:**
```typescript
{
  task: Task
  onUpdate: (updates) => void
  onComplete: () => void
  onDelete: () => void
  draggable?: boolean
  onDragStart?: () => void
  onDragOver?: () => void
  onDrop?: () => void
}
```

**Features:**
- Inline editing (title & description)
- Checkbox for completion
- Edit/Delete buttons
- Drag-and-drop support
- Strikethrough for completed

---

### TaskGroup Component
**Props:**
```typescript
{
  group: TaskGroup
  tasks: Task[]
  onUpdateGroup: (updates) => void
  onDeleteGroup: () => void
  onToggleExpanded: () => void
  onUpdateTask: (taskId, updates) => void
  onCompleteTask: (taskId) => void
  onDeleteTask: (taskId) => void
  onTaskDragStart: (taskId) => void
  onTaskDragOver: (taskId) => void
  onTaskDrop: (taskId) => void
}
```

**Features:**
- Expandable/collapsible
- Inline group name editing
- Contains multiple TaskItems
- Task count display
- Color-coded backgrounds

---

### PomodoroTimer Component
**Props:**
```typescript
{
  settings: PomodoroSettings
  isVisible: boolean
  onToggle: () => void
}
```

**Internal State:**
- `phase`: 'work' | 'shortBreak' | 'longBreak' | 'idle'
- `timeLeft`: seconds remaining
- `isRunning`: boolean
- `completedPomodoros`: count

**Features:**
- Phase management (work/break cycles)
- Countdown display (MM:SS)
- Start/Pause/Reset controls
- Auto-phase transitions
- Notifications

---

### VoiceAssistant Component
**Props:**
```typescript
{
  apiKey: string
  onCommand: (command) => void
}
```

**Internal State:**
- `isListening`: recording active
- `isProcessing`: API call in progress
- `error`: error message
- `transcript`: transcribed text

**Features:**
- Microphone access
- Audio recording (WebM)
- Visual feedback (colors, animations)
- Error handling
- Transcript display

---

### SettingsPanel Component
**Props:**
```typescript
{
  settings: AppSettings
  onUpdate: (updates) => void
  isOpen: boolean
  onClose: () => void
}
```

**Sections:**
1. AI Voice Assistant (API key)
2. Pomodoro Timer (durations, intervals, auto-start)
3. Display Options (sorting)

---

### DeleteConfirmModal Component
**Props:**
```typescript
{
  isOpen: boolean
  title: string
  onConfirm: () => void
  onCancel: () => void
}
```

**Features:**
- Backdrop overlay
- Escape key to close
- Prevents accidental deletions

---

## üóÉÔ∏è Data Models

### Task Interface
```typescript
{
  id: string              // UUID
  title: string           // Required
  description?: string    // Optional
  completed: boolean      // Status
  createdAt: number       // Timestamp
  completedAt?: number    // Timestamp
  groupId?: string        // Optional group assignment
  order: number           // For manual sorting
}
```

### TaskGroup Interface
```typescript
{
  id: string           // UUID
  name: string         // Group name
  color?: string       // Optional color theme
  expanded: boolean    // UI state
  order: number        // For sorting
  createdAt: number    // Timestamp
}
```

### AppSettings Interface
```typescript
{
  openAIApiKey: string
  pomodoro: {
    workDuration: number
    shortBreak: number
    longBreak: number
    longBreakInterval: number
    autoStartBreaks: boolean
    autoStartPomodoros: boolean
    notificationsEnabled: boolean
  }
  sortBy: 'createdAt' | 'alphabetical' | 'manual'
  theme: 'light' | 'dark'
}
```

---

## üîó Component Communication

### Parent ‚Üí Child (Props)
```
page.tsx passes data and callbacks to all components
```

### Child ‚Üí Parent (Callbacks)
```
Components call props.onXxx() to trigger parent actions
```

### Hook ‚Üí Components (State)
```
useTaskManager provides state and methods to page.tsx
```

### localStorage ‚Üî Hook (Persistence)
```
Hook auto-saves state changes to localStorage
Hook loads initial state from localStorage
```

### Voice ‚Üí State (Commands)
```
VoiceAssistant ‚Üí OpenAI API ‚Üí Parsed Command
‚Üí handleVoiceCommand ‚Üí useTaskManager methods
```

---

## üéØ Key Patterns

### 1. Controlled Components
All form inputs are controlled by React state

### 2. Lifting State Up
All state lives in useTaskManager, passed down as props

### 3. Callback Props
Parent functions passed to children for updates

### 4. Custom Hooks
Encapsulate complex state logic (useTaskManager)

### 5. Memoization
useCallback for stable function references

### 6. Effect Hooks
Auto-save, timers, cleanup functions

### 7. Conditional Rendering
Modal visibility, expanded states, empty states

---

## üö¶ State Management Strategy

```
localStorage
    ‚Üï (on load / on change)
useTaskManager Hook
    ‚Üì (provides)
State & Methods
    ‚Üì (passed as props)
Components
    ‚Üì (render)
User Interface
    ‚Üì (user actions)
Event Handlers
    ‚Üì (call methods)
useTaskManager Hook
    ‚Üì (updates state)
Auto-save to localStorage
```

---

## üé® Styling Architecture

### Tailwind Utility Classes
- Direct styling on JSX elements
- No separate CSS files per component
- Responsive and theme-aware

### Global Styles
- `globals.css` for base styles
- Custom scrollbar styling
- Smooth transition defaults

### Component-Specific
- Conditional classes based on state
- Dynamic color schemes for groups
- Hover and focus states

---

## üîê Error Boundaries

### Current Implementation
- Try-catch blocks in async operations
- Error state in VoiceAssistant
- Graceful degradation (no API key, no mic access)

### Validation
- Required field checks
- Non-empty title validation
- API response error handling

---

This architecture provides a clean separation of concerns, making the app maintainable, testable, and extensible.

